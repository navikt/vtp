name: Bygg

on:
  push:
    branches:
      - '**'
    paths-ignore:
      - '**.md'
      - '**.MD'
      - '.gitignore'
      - '.editorconfig'
      - '.java-version'
      - '.project'
      - 'LICENSE'
      - 'CODEOWNERS'
      - 'docs/**'
      - '.github/*.yml'

jobs:
  build-app:
    name: Build
    permissions:
      contents: read
      packages: write
    uses: navikt/fp-gha-workflows/.github/workflows/build-app-no-db.yml@main
    with:
      build-image: ${{ github.ref_name == 'master' }} # default: true
      push-image: ${{ github.ref_name == 'master' }} # default: false
      sonar-scan: true
      use-reader: true
    secrets: inherit

  release-drafter:
    name: Update
    permissions:
      contents: write
      pull-requests: read
    if: github.ref_name == 'master'
    needs: build-app
    uses: navikt/fp-gha-workflows/.github/workflows/release-drafter.yml@main
    secrets: inherit
